<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Functions `fit_LOCF_landmark` and `fit_LME_landmark` • Landmarking</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Functions `fit_LOCF_landmark` and `fit_LME_landmark`">
<meta property="og:description" content="Landmarking">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Landmarking</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Landmarking.html">Introduction to Landmark Models</a>
    </li>
    <li>
      <a href="../articles/how_to_use.html">How to use the R package 'Landmarking'</a>
    </li>
    <li>
      <a href="../articles/Functions_fit_LOCF_LME_landmark.html">The functions 'fit_LOCF_landmark' and 'fit_LME_landmark'</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://https://github.com/isobelbarrott/Landmarking/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Functions_fit_LOCF_LME_landmark_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Functions <code>fit_LOCF_landmark</code> and <code>fit_LME_landmark</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/isobelbarrott/Landmarking/blob/master/vignettes/Functions_fit_LOCF_LME_landmark.Rmd" class="external-link"><code>vignettes/Functions_fit_LOCF_LME_landmark.Rmd</code></a></small>
      <div class="hidden name"><code>Functions_fit_LOCF_LME_landmark.Rmd</code></div>

    </div>

    
    
<div id="diagram-of-the-functions-fit_locf_landmark-and-fit_lme_landmark" class="section level2">
<h2 class="hasAnchor">
<a href="#diagram-of-the-functions-fit_locf_landmark-and-fit_lme_landmark" class="anchor" aria-hidden="true"></a>Diagram of the functions <code>fit_LOCF_landmark</code> and <code>fit_LME_landmark</code>
</h2>
<p>Here is a visual illustration of the functions <code>fit_LOCF_landmark</code> (selecting option <code>fit_LOCF_longitudinal</code>) and <code>fit_LME_landmark</code> (selecting option <code>fit_LME_longitudinal</code>) to show how they are made up of their helper functions. These are available with the R package Landmarking.</p>
<div class="figure">
<img src="images/fit_LOCF_landmark_model.pdf" alt="*Figure 1: *" width="100%"><p class="caption">
<em>Figure 1: </em>
</p>
</div>
<p>The description of these functions contained in <code>help()</code> is listed below to provide more detail.</p>
<div id="function-add_cv_number" class="section level3">
<h3 class="hasAnchor">
<a href="#function-add_cv_number" class="anchor" aria-hidden="true"></a>Function <code>add_cv_number</code>
</h3>
<p>Randomly assigns a k-fold cross-validation number to each individual in a dataset.</p>
</div>
<div id="function-fit_locf_landmark" class="section level3">
<h3 class="hasAnchor">
<a href="#function-fit_locf_landmark" class="anchor" aria-hidden="true"></a>Function <code>fit_LOCF_landmark</code>
</h3>
<p>This function extracts the LOCF value for each of the <code>covariates</code> in <code>data_long</code> up to (but not including) time <code>x_L</code>.</p>
</div>
<div id="function-fit_lme_landmark" class="section level3">
<h3 class="hasAnchor">
<a href="#function-fit_lme_landmark" class="anchor" aria-hidden="true"></a>Function <code>fit_LME_landmark</code>
</h3>
<p>Firstly, the LME model is outlined. For an individual , the LME model can be written as</p>
<p>where *  is the vector of outcomes at different time points for the individual *  is the matrix of covariates for the fixed effects at these time points *  is the vector of coefficients for the fixed effects *  is the matrix of covariates for the random effects *  is the matrix of coefficients for the random effects *  is the error term, typically from N(0, )</p>
<p>By using an LME model to fit repeat measures data we can allow measurements from the same individuals to be more similar than measurements from different individuals. This is done through the random intercept and/or random slope.</p>
<p>Extending this model to the case where there are multiple random effects, denoted , we have</p>
<p>Using this model we can allow a covariance structure within the random effects term , for example a sample from the multivariate normal (MVN) distribution . This covariance structure means the value of one random effects variable informs about the value of the other random effects variables, leading to more accurate predictions and allowing there to be missing data in the random effects variables.</p>
<p>The function  uses this covariance structure for the random effects when fitting the LME model. To fit the LME model the function  from the package  is used. The fixed effects are calculated as the LOCF for the variables  at the landmark age  and the random effects are those stated in  and at times . The random intercept is always included in the LME model. Additionally, the random slope can be included in the LME model using the parameter <code>random_slope_in_LME=TRUE</code>. The model is used to predict the values of the random effects at the landmark time , and these are used as predictors in the survival model along with the LOCF values of the fixed effects. Additionally, the estimated value of the random slope can be included as predictors in the survival model using the parameter <code>random_slope_as_covariate=TRUE</code>.</p>
<p>It is important to distinguish between the validation set and the development set for fitting the LME model. The development set includes all the repeat measurements (including those after the landmark age ). Conversely, the validation set only includes the repeat measurements recorded up until and including the landmark age .</p>
<p>There is an important consideration about fitting the linear mixed effects model. As the variable  gets further from 0, the random effects coefficients get closer to 0. This causes computational issues as the elements in the covariance matrix of the random effects, , are constrained to be greater than 0. Using parameter  can prevent this issue by standardising the time variables to ensure that the  values are not too close to 0.</p>
<p>The LOCF values for the fixed effects and the prediction of the random effects at the landmark age are used as the covariates for the survival submodel, in addition to the estimated random slopes if option <code>random_effects_as_covariate</code> is selected.</p>
</div>
<div id="function-fit_survival_model" class="section level3">
<h3 class="hasAnchor">
<a href="#function-fit_survival_model" class="anchor" aria-hidden="true"></a>Function <code>fit_survival_model</code>
</h3>
<p>For the survival submodel, there are three choices of model: * the standard Cox model, this is a wrapper function for  from the package  * the cause-specific model, this is a wrapper function for  from package  * the Fine Gray model, this is a wrapper function for  from package </p>
<p>The latter two models estimate the probability of the event of interest in the presence of competing events.</p>
<p>For both the c-index and Brier score calculations, inverse probability censoring weighting (IPCW) is used to create weights which account for the occurrence of censoring. The censoring model assumes for this function is the Kaplan Meier model, i.e. censoring occurs independently of covariates.</p>
</div>
<div id="function-get_model_assessment" class="section level3">
<h3 class="hasAnchor">
<a href="#function-get_model_assessment" class="anchor" aria-hidden="true"></a>Function <code>get_model_assessment</code>
</h3>
<p>There are two factors in assessing the performance of a prediction model; its discrimination and its calibration. The c-index is one method to assess discrimination, this refers to the ability of the model to separate individuals into those that will have an event and those that will not. The c-index at a horizon time <code>x_hor</code> looks at the pairs of individuals where one individual has the event at a time T and the other has not had the event at time T. It is calculated as the proportion of these pairs where their relative risk prediction agrees with the actual outcomes for the two individuals. This is extended to the competing risks case by comparing individuals where one had the event of interest at time T and the other individual either did not experience the event before this time T or experienced a competing event.</p>
<p>The Brier score is one method to assess calibration, this refers to the agreement between the risk prediction and the outcome. The Brier score is calculated as the average mean squared error of the predicted risk and the event outcome (where an event is 1 and not experiencing the event is 0). This is extended to the competing risks case by including the competing risk events as not experiencing the event.</p>
<p>For both the c-index and Brier score calculations, inverse probability censoring weighting (IPCW) is used to create weights which account for the occurence of censoring. The censoring model assumes for this function is the Kaplan Meier model, i.e. censoring occurs independently of covariates.</p>
<p>The c-index is calculated using the <code>cindex</code> function in package <code>pec</code>. The Brier score is calculated using <code>pec</code> function in package <code>pec</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Isobel Barrott, Jessica Barrett.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
